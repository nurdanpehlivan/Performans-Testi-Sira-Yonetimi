<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seminer KayÄ±t & Akreditasyon Sistemi</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .ticket-card { border-radius: 20px; border: none; transition: transform 0.3s; }
        .ticket-card:hover { transform: translateY(-5px); }
        .display-ticket { font-size: 5rem; font-weight: 800; color: #0d6efd; letter-spacing: -2px; }
        .btn-primary { padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1.2rem; }
    </style>
</head>
<body>
    <div id="app" class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card ticket-card shadow-lg p-4">
                    <div class="text-center mb-4">
                        <h2 class="fw-bold text-dark">Seminer KayÄ±t Sistemi</h2>
                        <p class="text-muted small">GÃ¼venli Belge DoÄŸrulama ve Performans Testi</p>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">KatÄ±lÄ±mcÄ± TÃ¼rÃ¼ SeÃ§iniz:</label>
                        <select v-model="serviceType" class="form-select form-select-lg mb-3">
                            <option value="OGRENCI">Ã–ÄŸrenci KatÄ±lÄ±mcÄ±</option>
                            <option value="SEKTOR">SektÃ¶r Profesyoneli</option>
                            <option value="PROTOKOL">KonuÅŸmacÄ± / Protokol (VIP)</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold text-danger">KatÄ±lÄ±m Belgesi YÃ¼kle (Zorunlu):</label>
                        <input type="file" @change="handleFileUpload" class="form-control" accept="image/*,.pdf">
                        <small class="text-muted">LÃ¼tfen Ã¶ÄŸrenci belgesi veya davetiye (PDF/GÃ¶rsel) yÃ¼kleyiniz.</small>
                    </div>

                    <button @click="getTicket" class="btn btn-primary w-100 shadow-sm" :disabled="loading">
                        <span v-if="loading" class="spinner-border spinner-border-sm me-2"></span>
                        <span v-else>ğŸ« KAYDI TAMAMLA VE BÄ°LET AL</span>
                    </button>

                    <div v-if="ticketNumber" class="mt-4 text-center animate__animated animate__zoomIn">
                        <hr>
                        <p class="text-muted mb-1">Akreditasyon OnaylandÄ±!</p>
                        <div class="display-ticket mb-1">{{ serviceType.substring(0,2) }}-{{ ticketNumber }}</div>
                        <div class="badge bg-success p-2">SÄ±ranÄ±z GÃ¼venli VeritabanÄ±na Kaydedildi</div>
                    </div>

                    <div v-if="status" class="mt-3 small text-center" :class="status.includes('Hata') ? 'text-danger' : 'text-primary'">
                        {{ status }}
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <small class="text-muted">Nurdan Pehlivan - SLA & GÃ¼venlik Performans Projesi 2025</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    ticketNumber: null,
                    loading: false,
                    status: '',
                    serviceType: 'OGRENCI',
                    selectedFile: null
                }
            },
            methods: {
                handleFileUpload(event) {
                    this.selectedFile = event.target.files[0];
                },
                async getTicket() {
                    // 1. ZORUNLULUK KONTROLÃœ
                    if (!this.selectedFile) {
                        this.ticketNumber = null;
                        this.status = 'Hata: Seminer kaydÄ± iÃ§in lÃ¼tfen katÄ±lÄ±m belgenizi seÃ§iniz!';
                        return; 
                    }

                    // 2. UzantÄ± kontrolÃ¼ (PDF veya Resim mi?)
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
                    if (!allowedTypes.includes(this.selectedFile.type)) {
                        this.status = 'Hata: Sadece PDF veya GÃ¶rsel formatlarÄ± kabul edilmektedir!';
                        return;
                    }

                    this.ticketNumber = null; 
                    this.loading = true;
                    this.status = 'Belgeniz mikroservis (ClamAV) ile taranÄ±yor...';
                    
                    const formData = new FormData();
                    formData.append('service_type', this.serviceType);
                    formData.append('file', this.selectedFile);

                    try {
                        const response = await axios.post('http://localhost:8000/api/create-ticket/', formData);
                        
                        this.ticketNumber = response.data.ticket_number;
                        this.status = 'GÃ¼venlik onayÄ± alÄ±ndÄ±. KaydÄ±nÄ±z baÅŸarÄ±yla tamamlandÄ±.';
                    } catch (error) {
                        console.error(error);
                        
                        if (error.response && error.response.data && error.response.data.message) {
                            this.status = 'Hata: ' + error.response.data.message;
                        } else {
                            this.status = 'Hata: API sunucusuna ulaÅŸÄ±lamadÄ± veya gÃ¼venlik engeline takÄ±ldÄ±!';
                        }
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>